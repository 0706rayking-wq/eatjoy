<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å»šæˆ¿ç®¡ç†ç³»çµ± Kitchen OS</title>
    <!-- å¼•å…¥ React, ReactDOM, Babel, Tailwind, å’Œ Lucide -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- ä½¿ç”¨ lucide çš„åŸºæœ¬åº«è€Œé lucide-react é¿å… forwardRef éŒ¯èª¤ -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .page-enter { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 pb-12">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- æ ¸å¿ƒé…ç½® ---
        const ZONES = [
            { id: 'beverage', name: 'é£²èª¿å€' }, { id: 'light-meal', name: 'è¼•é£Ÿå€' },
            { id: 'seafood', name: 'æµ·é®®å€' }, { id: 'vegetable', name: 'è”¬èœå€' },
            { id: 'meat', name: 'åˆ‡è‚‰å€' }, { id: 'cold-platter', name: 'å†·ç›¤å€' },
            { id: 'cooked-food', name: 'ç†Ÿé£Ÿå€' }, { id: 'soup', name: 'æ¹¯å“å€' }
        ];

        // åœ–ç¤ºåŒ…è£çµ„ä»¶ï¼Œé¿å…ç›´æ¥æ¸²æŸ“ç‰©ä»¶å°è‡´çš„ Error 130
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => {
                lucide.createIcons();
            }, [name, size, className]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        const ChefHatIcon = () => (
            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" strokeWidth="2.5" fill="none" strokeLinecap="round" strokeLinejoin="round">
                <path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"/>
                <line x1="6" y1="17" x2="18" y2="17"/>
            </svg>
        );

        // --- å®Œæ•´æ¢æ¬¾è³‡æ–™ (PDF å…§å®¹) ---
        const RULES_CONTENT = {
            hygiene: [
                { cat: "å¥åº·æª¢æŸ¥", items: ["å¾æ¥­äººå“¡å¥åº·æª¢æŸ¥æ‡‰åŒ…æ‹¬èƒ¸éƒ¨Xå…‰åŠAå‹è‚ç‚æŠ—é«”æª¢é©—ã€‚"] },
                { cat: "é£Ÿæé›¢åœ°æ”¾ç½®", items: ["é£Ÿææ‡‰é›¢ç‰†5å…¬åˆ†ï¼Œé›¢åœ°20å…¬åˆ†ã€‚"] },
                { cat: "é¿å…äº¤å‰æ±¡æŸ“", items: ["ç §æ¿ã€åˆ€å…·ã€å®¹å™¨æ‡‰ç”Ÿç†Ÿé£Ÿå€åˆ†ï¼Œç¢ºä¿é›™æ‰‹æ´—æ·¨å†è§¸ç¢°é£Ÿæã€‚", "éé£Ÿæå‹¿ç½®æ”¾è‡³ç §æ¿ä¸Šã€‚", "é£ŸææœªåŠ å°åŠ è“‹ä¸‹è«‹å‹¿äº¤ç–Šã€‚"] },
                { cat: "å…ˆé€²å…ˆå‡º", items: ["å†°ç®±é£Ÿæå®œæ‰“æ¨™ã€å¡«å¯«æ—¥æœŸã€å§“åä»¥åˆ©å…ˆé€²å…ˆå‡ºã€‚", "ä¸‹ç­å‰é ˆå°‡å†·å‡å†·è—æ•´ç†æ•´é½Šä»¥åˆ©é»è²¨ã€‚"] },
                { cat: "é©ç•¶æº«åº¦ä¿å­˜", items: ["ç´°èŒæ»‹ç”Ÿæº«ç‚º16~59åº¦ã€‚è½å¯¦å¡«å¯«æº«åº¦è¨˜éŒ„è¡¨ã€‚", "éš¨æ‰‹é—œé–€ã€‚"] }
            ],
            occupational: [
                { cat: "åˆ‡è‚‰æ©Ÿ/åˆ‡è”¥æ©Ÿ", items: ["åš´ç¦å¾’æ‰‹æ¥è§¸æ—‹è½‰åˆ€ç‰‡ï¼Œé ˆä½¿ç”¨æ¨è‚‰æ¿ã€‚", "æ¸…æ½”æ™‚å¿…é ˆé—œæ©Ÿä¸¦æ‹”é™¤é›»æºã€‚", "é›»æ©Ÿèˆ‡é–‹é—œéƒ¨åˆ†åš´ç¦ç›´æ¥æ²–æ°´ã€‚"] },
                { cat: "å‡è³ªæ©Ÿ/èª¿ç†æ©Ÿ", items: ["é‹è½‰ä¸­åš´ç¦é–‹å•Ÿä¸Šè“‹ã€‚å‡è³ªçµæŸå¾Œé ˆå…ˆé‡‹å£“å†é–‹è“‹ã€‚"] },
                { cat: "ç“¦æ–¯çˆå…·å®‰å…¨", items: ["é–‹ç“¦æ–¯â†’é»ç«â†’é—œç«â†’é—œç“¦æ–¯ï¼Œé †åºé ˆæ­£ç¢ºã€‚", "é›œç‰©è·ç«æºè‡³å°‘30å…¬åˆ†ã€‚"] },
                { cat: "å†·å‡åº«å®‰å…¨", items: ["é€²å…¥å‰é€šçŸ¥åŒäº‹ï¼Œç¢ºèªé€ƒç”Ÿè£ç½®æ­£å¸¸ï¼Œåš´ç¦é•·æ™‚é–“é€—ç•™ã€‚"] }
            ],
            standard: [
                { id: 1, title: "æ‰“å¡è¦å®š", desc: "ä¸Šç­é²åˆ°ã€ç¿¹ç­éœ€ä¾è¦å®šã€‚éœ€è‘—è£ç½®ç‰©å®Œç•¢å†æ‰“å¡ï¼Œå¦å‰‡è¦–åŒé²åˆ°ã€‚" },
                { id: 3, title: "æ‰‹æ©Ÿä½¿ç”¨é™åˆ¶", desc: "ç¦æ­¢éå¹¹éƒ¨ä¸Šç­æ™‚é–“ä½¿ç”¨æ‰‹æ©Ÿï¼Œç™¼ç¾ä¸€ç‡æ‡²è™•ã€‚" },
                { id: 10, title: "æœè£èˆ‡å¦‚å»è¦å®š", desc: "é ­é«®ä¸å¤–éœ²ã€ç©¿å®‰å…¨é‹ï¼›å¦‚å»é™6åˆ†é˜ï¼Œç‰¹æ®Šéœ€æ±‚é ˆæå‰å‘ŠçŸ¥ã€‚" },
                { id: 13, title: "å·¥ä½œæ…‹åº¦", desc: "ç¦æ­¢æ–¼å®¢äººé¢å‰çˆ­åŸ·ï¼›ä¸çµ¦é¡§å®¢è² é¢è§€æ„Ÿã€‚" },
                { id: 14, title: "ç·Šæ€¥å‡ºå£", desc: "å‡ºå£éœ€ä¿æŒæš¢é€šï¼Œéç½®ç‰©å€ä¸å¾—å †æ”¾ç§äººç‰©å“ã€‚" }
            ]
        };

        const App = () => {
            const [currentPage, setCurrentPage] = useState('home');
            const [isManager, setIsManager] = useState(false);
            const [showLoginModal, setShowLoginModal] = useState(false);
            const [passwordInput, setPasswordInput] = useState('');
            const [loginError, setLoginError] = useState(false);
            const [selectedAnnouncement, setSelectedAnnouncement] = useState(null);
            const [selectedRuleCategory, setSelectedRuleCategory] = useState(null);

            // --- æ•¸æ“šæŒä¹…åŒ– ---
            const [announcements, setAnnouncements] = useState(() => JSON.parse(localStorage.getItem('k_ann')) || [
                { id: 1, date: '2024-05-20', title: 'å¤å­£èœå–®èª¿æ•´é€šçŸ¥', content: 'ç†Ÿé£Ÿå€å°‡æ–°å¢ä¸‰é“å¤å­£æ¶¼æ‹Œèœï¼Œè«‹å„å€äººå“¡ç•™æ„å‡ºé¤æ¨™æº–ã€‚åŒ…å«æ¶¼æ‹Œé’æœ¨ç“œã€èƒ¡éº»é»ƒç“œä»¥åŠæ³°å¼é…¸è¾£èŠ±æã€‚', author: 'ä¸»å»š' }
            ]);
            const [schedules, setSchedules] = useState(() => JSON.parse(localStorage.getItem('k_sch')) || {});
            const [standards, setStandards] = useState(() => JSON.parse(localStorage.getItem('k_std')) || {});
            const [completedZones, setCompletedZones] = useState(() => JSON.parse(localStorage.getItem('k_done')) || []);
            const [lastResetDate, setLastResetDate] = useState(localStorage.getItem('k_reset_date') || "");
            const [notificationLog, setNotificationLog] = useState([]);

            useEffect(() => {
                localStorage.setItem('k_ann', JSON.stringify(announcements));
                localStorage.setItem('k_sch', JSON.stringify(schedules));
                localStorage.setItem('k_std', JSON.stringify(standards));
                localStorage.setItem('k_done', JSON.stringify(completedZones));
            }, [announcements, schedules, standards, completedZones]);

            // è‡ªå‹•æª¢æŸ¥èˆ‡é‡ç½®é‚è¼¯ (19:00 é‡ç½®, 22:30 æé†’)
            useEffect(() => {
                const timer = setInterval(() => {
                    const now = new Date();
                    const h = now.getHours();
                    const m = now.getMinutes();
                    const today = now.toDateString();

                    if (h === 19 && m === 0 && lastResetDate !== today) {
                        setCompletedZones([]);
                        setLastResetDate(today);
                        localStorage.setItem('k_reset_date', today);
                        addNotify("ğŸ® ç³»çµ±å·²é‡ç½®ä»Šæ—¥å–„å¾Œé€²åº¦ã€‚");
                    }
                    if (h === 22 && m === 30 && lastResetDate === today) {
                        if (completedZones.length < ZONES.length) {
                            const rem = ZONES.filter(z => !completedZones.includes(z.id)).map(z => z.name);
                            addNotify(`âš ï¸ æé†’ï¼šå°šæœªå®Œæˆå€åŸŸï¼š${rem.join(', ')}`);
                        }
                    }
                }, 30000);
                return () => clearInterval(timer);
            }, [completedZones, lastResetDate]);

            const addNotify = (msg) => {
                const time = new Date().toLocaleTimeString();
                setNotificationLog(prev => [{ time, message: msg }, ...prev].slice(0, 5));
            };

            const handleLogin = () => {
                if (passwordInput === 'eatjoy0706') {
                    setIsManager(true);
                    setShowLoginModal(false);
                    setPasswordInput('');
                    setLoginError(false);
                } else {
                    setLoginError(true);
                }
            };

            const renderContent = () => {
                switch(currentPage) {
                    case 'home': return <HomePage onNavigate={setCurrentPage} announcements={announcements} doneCount={completedZones.length} onOpenDetail={(a) => { setSelectedAnnouncement(a); setCurrentPage('annDetail'); }} />;
                    case 'onboarding': return <OnboardingPage onBack={() => setCurrentPage('home')} onNavigate={setCurrentPage} />;
                    case 'workRoute': return <WorkRoutePage onBack={() => setCurrentPage('onboarding')} />;
                    case 'rules': return <RulesPage onBack={() => setCurrentPage('home')} onSelect={(c) => { setSelectedRuleCategory(c); setCurrentPage('ruleDetail'); }} />;
                    case 'ruleDetail': return <RuleDetailPage category={selectedRuleCategory} onBack={() => setCurrentPage('rules')} />;
                    case 'benefits': return <BenefitsPage onBack={() => setCurrentPage('home')} />;
                    case 'schedule': return <SchedulePage onBack={() => setCurrentPage('home')} schedules={schedules} />;
                    case 'inspection': return <InspectionPage onBack={() => setCurrentPage('home')} standards={standards} setStandards={setStandards} completedZones={completedZones} setCompletedZones={setCompletedZones} isManager={isManager} addLog={addNotify} />;
                    case 'annDetail': return <AnnouncementDetailPage ann={selectedAnnouncement} onBack={() => setCurrentPage('home')} />;
                    case 'admin': return <AdminPage onBack={() => setCurrentPage('home')} onLogout={() => setIsManager(false)} announcements={announcements} setAnnouncements={setAnnouncements} schedules={schedules} setSchedules={setSchedules} log={notificationLog} />;
                    default: return <HomePage onNavigate={setCurrentPage} announcements={announcements} />;
                }
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <header className={`${isManager ? 'bg-slate-800' : 'bg-orange-600'} text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-lg transition-colors`}>
                        <div className="flex items-center gap-2 cursor-pointer" onClick={() => setCurrentPage('home')}>
                            <div className="bg-white/20 p-1 rounded-lg"><ChefHatIcon /></div>
                            <span className="font-bold text-xl tracking-tight">Kitchen OS</span>
                        </div>
                        <div className="flex gap-4 items-center">
                            <button onClick={() => isManager ? setCurrentPage('admin') : setShowLoginModal(true)}>
                                {isManager ? <Icon name="settings" size={22} /> : <Icon name="menu" size={22} />}
                            </button>
                        </div>
                    </header>

                    <div className="flex-grow">{renderContent()}</div>

                    {showLoginModal && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-6">
                            <div className="bg-white w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl text-center page-transition">
                                <div className="bg-orange-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-orange-600"><Icon name="lock" size={32} /></div>
                                <h2 className="text-2xl font-black mb-6 text-slate-800">ä¸»ç®¡æˆæ¬Š</h2>
                                <div className="space-y-4">
                                    <input type="password" value={passwordInput} onChange={(e) => setPasswordInput(e.target.value)} placeholder="ç®¡ç†å¯†ç¢¼" className={`w-full bg-slate-100 border-2 ${loginError ? 'border-red-400' : 'border-transparent'} focus:border-orange-500 rounded-2xl px-5 py-4 outline-none font-bold text-center`} onKeyDown={(e) => e.key === 'Enter' && handleLogin()} />
                                    <button onClick={handleLogin} className="w-full bg-slate-900 text-white font-black py-4 rounded-2xl shadow-xl active:scale-95 transition-all">æˆæ¬Šé€²å…¥</button>
                                    <button onClick={() => setShowLoginModal(false)} className="text-slate-400 text-xs font-bold uppercase py-2">å–æ¶ˆ</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- å­çµ„ä»¶ ---

        const HomePage = ({ onNavigate, announcements, doneCount, onOpenDetail }) => (
            <div className="p-4 space-y-6 page-enter">
                <div className="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 flex items-center justify-between">
                    <div className="flex items-center gap-4">
                        <div className="w-12 h-12 bg-orange-100 text-orange-600 rounded-2xl flex items-center justify-center font-black">{doneCount}</div>
                        <div>
                            <p className="text-[10px] font-black text-slate-300 uppercase tracking-widest leading-none mb-1">ä»Šæ—¥é€²åº¦</p>
                            <p className="text-sm font-black text-slate-700">{doneCount === ZONES.length ? "âœ… å…¨æ•¸å®Œæˆ" : `å°šæœ‰ ${ZONES.length - doneCount} ç«™å¾…è™•ç†`}</p>
                        </div>
                    </div>
                    <button onClick={() => onNavigate('inspection')} className="p-3 bg-orange-600 text-white rounded-2xl shadow-lg"><Icon name="camera" size={20}/></button>
                </div>

                <section>
                    <h2 className="text-lg font-bold flex items-center gap-2 mb-3 px-1 text-slate-400"><Icon name="bell" size={18} className="text-orange-500" /> ç‡Ÿé‹èª¿æ•´å…¬å‘Š</h2>
                    <div className="space-y-3">
                        {announcements.map(ann => (
                            <div key={ann.id} onClick={() => onOpenDetail(ann)} className="bg-white p-5 rounded-[2rem] shadow-sm border-l-4 border-orange-500 active:bg-orange-50 transition-colors cursor-pointer group">
                                <div className="flex justify-between items-start mb-1">
                                    <h3 className="font-bold text-slate-800 text-sm group-hover:text-orange-600 transition-colors">{ann.title}</h3>
                                    <span className="text-[9px] text-slate-400 bg-slate-50 px-2 py-1 rounded-full font-bold">{ann.date}</span>
                                </div>
                                <p className="text-xs text-slate-500 line-clamp-2 break-all leading-relaxed">{ann.content}</p>
                            </div>
                        ))}
                    </div>
                </section>

                <section className="grid grid-cols-2 gap-4">
                    <NavCard title="å…¥è·ç›¸é—œ" onClick={() => onNavigate('onboarding')} bg="bg-blue-50/50" />
                    <NavCard title="å“¡å·¥å®ˆå‰‡" onClick={() => onNavigate('rules')} bg="bg-emerald-50/50" />
                    <NavCard title="è–ªè³‡ç¦åˆ©" onClick={() => onNavigate('benefits')} bg="bg-yellow-50/50" />
                    <NavCard title="æ¯æœˆç­è¡¨" onClick={() => onNavigate('schedule')} bg="bg-indigo-50/50" />
                    <NavCard title="å–„å¾Œå·¡è¦–ç³»çµ±" onClick={() => onNavigate('inspection')} bg="bg-orange-50" span={true} />
                </section>
            </div>
        );

        const NavCard = ({ title, onClick, bg, span = false }) => (
            <button onClick={onClick} className={`${bg} ${span ? 'col-span-2 py-16' : 'py-14'} rounded-[2.5rem] shadow-sm border border-slate-100 active:scale-95 transition-all text-center`}>
                <span className="font-black text-slate-800 text-2xl tracking-tighter">{title}</span>
            </button>
        );

        const OnboardingPage = ({ onBack, onNavigate }) => (
            <div className="p-4 space-y-4 page-enter">
                <BackButton onClick={onBack} title="å…¥è·ç›¸é—œ" />
                <div className="space-y-3">
                    <SectionItem title="å“¡å·¥å…¥è·æº–å‚™æ¸…å–®" icon="book-open" />
                    <SectionItem title="åœè»Šè³‡è¨Š" icon="car" />
                    <div onClick={() => onNavigate('workRoute')}><SectionItem title="ä¸Šç­å‹•ç·šæŒ‡å¼•" icon="map-pin" /></div>
                </div>
            </div>
        );

        const WorkRoutePage = ({ onBack }) => (
            <div className="p-4 space-y-6 page-enter">
                <BackButton onClick={onBack} title="ä¸Šç­å‹•ç·šæŒ‡å¼•" />
                <RouteSection title="æ­ä¹˜å¤§çœ¾é‹è¼¸è·¯ç·š" icon="bus" color="bg-blue-100 text-blue-600" />
                <RouteSection title="é–‹è»Šæˆ–é¨è»Šè·¯ç·š" icon="bike" color="bg-orange-100 text-orange-600" />
            </div>
        );

        const RouteSection = ({ title, icon, color }) => (
            <section className="bg-white rounded-[2.5rem] p-6 shadow-sm border border-slate-100">
                <div className="flex items-center gap-3 mb-4 text-slate-700">
                    <div className={`${color} p-2 rounded-xl`}><Icon name={icon} size={20} /></div>
                    <h3 className="font-black">{title}</h3>
                </div>
                <div className="aspect-video bg-slate-100 rounded-3xl flex flex-col items-center justify-center border-2 border-dashed border-slate-200">
                    <Icon name="play-circle" size={40} className="text-slate-300 mb-2" />
                    <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest italic">Video Space</p>
                </div>
            </section>
        );

        const RulesPage = ({ onBack, onSelect }) => (
            <div className="p-4 space-y-3 page-enter">
                <BackButton onClick={onBack} title="å“¡å·¥å®ˆå‰‡" />
                <SectionItem title="é£Ÿå“è¡›ç”Ÿå®‰å…¨è¦ç¯„" icon="shield-check" onClick={() => onSelect('hygiene')} />
                <SectionItem title="è·å ´è·æ¥­å®‰å…¨å®ˆå‰‡" icon="flame" onClick={() => onSelect('occupational')} />
                <SectionItem title="å»šæˆ¿æ¨™æº–å·¥ä½œå®ˆå‰‡" icon="book-open" onClick={() => onSelect('standard')} />
            </div>
        );

        const RuleDetailPage = ({ category, onBack }) => {
            const data = useMemo(() => {
                if(category === 'hygiene') return { title: "é£Ÿå“è¡›ç”Ÿå®‰å…¨", content: RULES_CONTENT.hygiene.map((c, i) => <RuleBlock key={i} index={i+1} title={c.cat} items={c.items} />) };
                if(category === 'occupational') return { title: "è·å ´å®‰å…¨å®ˆå‰‡", content: RULES_CONTENT.occupational.map((c, i) => <RuleBlock key={i} index={i+1} title={c.cat} items={c.items} />) };
                return { title: "å»šæˆ¿æ¨™æº–å®ˆå‰‡", content: RULES_CONTENT.standard.map(c => <RuleStandardBlock key={c.id} id={c.id} title={c.title} desc={c.desc} />) };
            }, [category]);
            return <div className="p-4 space-y-4 page-enter pb-10"><BackButton onClick={onBack} title={data.title} />{data.content}</div>;
        };

        const RuleBlock = ({ index, title, items }) => (
            <div className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100 mb-4">
                <h3 className="font-bold text-slate-800 mb-3 text-sm flex gap-2"><span className="text-slate-300 font-black">{index}.</span> {title}</h3>
                <ul className="space-y-1">{items.map((it, idx) => <li key={idx} className="text-xs text-slate-500">â€¢ {it}</li>)}</ul>
            </div>
        );

        const RuleStandardBlock = ({ id, title, desc }) => (
            <div className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100 mb-4 flex gap-4">
                <div className="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-black shrink-0">{id}</div>
                <div className="space-y-1"><h3 className="font-bold text-slate-800 text-sm">{title}</h3><p className="text-[10px] text-slate-400 italic bg-slate-50 p-2 rounded-lg">{desc}</p></div>
            </div>
        );

        const SchedulePage = ({ onBack, schedules }) => {
            const currentMonth = new Date().toISOString().slice(0, 7);
            const [viewMonth, setViewMonth] = useState(currentMonth);
            const imgs = schedules[viewMonth] || [];
            return (
                <div className="p-4 space-y-6 page-enter">
                    <BackButton onClick={onBack} title="æ¯æœˆç­è¡¨æŸ¥è©¢" />
                    <div className="bg-white p-4 rounded-3xl border flex items-center justify-between mb-4 shadow-sm">
                        <input type="month" value={viewMonth} onChange={(e) => setViewMonth(e.target.value)} className="bg-slate-50 p-2 rounded-xl font-bold outline-none" />
                        <span className="text-[9px] font-black text-slate-300 uppercase tracking-widest">Selected</span>
                    </div>
                    {imgs.length > 0 ? imgs.map((img, i) => <div key={i} className="bg-white p-2 rounded-3xl shadow-md border mb-4"><img src={img} className="w-full rounded-2xl" /></div>) : (
                        <div className="bg-white p-12 rounded-[2.5rem] border-2 border-dashed border-slate-100 text-center space-y-4 text-slate-200 font-black italic">NO SCHEDULE FOUND</div>
                    )}
                </div>
            );
        };

        const InspectionPage = ({ onBack, standards, setStandards, completedZones, setCompletedZones, isManager, addLog }) => {
            const [activeZone, setActiveZone] = useState(null);
            const [uploads, setUploads] = useState([]);
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [isSettings, setIsSettings] = useState(false);

            const handleFile = (e, type, zoneId = null) => {
                const files = Array.from(e.target.files);
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        if(type === 'std') setStandards(prev => ({ ...prev, [zoneId]: [...(prev[zoneId] || []), reader.result] }));
                        else setUploads(prev => [...prev, reader.result]);
                    };
                    reader.readAsDataURL(file);
                });
            };

            const runAI = () => {
                setLoading(true);
                setTimeout(() => {
                    setResult({ status: 'PASS', summary: "ç’°å¢ƒæ•´æ½”åˆæ ¼ï¼Œæ¡Œé¢ç„¡æ®˜ç•™ã€‚" });
                    if(!completedZones.includes(activeZone.id)) {
                        const newList = [...completedZones, activeZone.id];
                        setCompletedZones(newList);
                        if(newList.length === ZONES.length) addLog("âœ… ä»Šæ—¥å…¨å“¡å®Œæˆä¸Šå‚³ï¼");
                    }
                    setLoading(false);
                }, 1500);
            };

            if(isSettings) return (
                <div className="p-4 space-y-6 page-enter pb-20">
                    <BackButton onClick={() => setIsSettings(false)} title="å€åŸŸæ¨™æº–ç…§" />
                    {ZONES.map(z => (
                        <div key={z.id} className="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 mb-4">
                            <div className="flex justify-between items-center mb-4"><h3 className="font-black text-slate-700">{z.name}</h3><label className="bg-slate-900 text-white px-5 py-2 rounded-xl text-[10px] font-black uppercase cursor-pointer">Upload<input type="file" multiple className="hidden" onChange={(e) => handleFile(e, 'std', z.id)} /></label></div>
                            <div className="grid grid-cols-4 gap-2">{(standards[z.id] || []).map((img, i) => <div key={i} className="relative aspect-square"><img src={img} className="w-full h-full object-cover rounded-xl border" /><button onClick={() => setStandards(prev => ({...prev, [z.id]: prev[z.id].filter((_, idx) => idx !== i)}))} className="absolute -top-1 -right-1 bg-red-500 text-white p-1 rounded-full shadow-md"><Icon name="trash-2" size={10}/></button></div>)}</div>
                        </div>
                    ))}
                </div>
            );

            if(activeZone) return (
                <div className="p-4 space-y-6 page-enter pb-10">
                    <button onClick={() => { setActiveZone(null); setResult(null); setUploads([]); }} className="p-3 bg-white rounded-2xl shadow-sm border border-slate-100"><Icon name="arrow-left" size={20}/></button>
                    <h3 className="text-4xl font-black text-slate-800 text-center tracking-tighter uppercase">{activeZone.name}</h3>
                    <section><p className="text-xs font-black text-slate-300 uppercase mb-3 text-center">Standard Ref</p><div className="flex gap-2 overflow-x-auto no-scrollbar pb-2">{(standards[activeZone.id] || []).map((img, i) => <img key={i} src={img} className="w-32 h-32 object-cover rounded-3xl border-2 border-white shadow-sm" />)}</div></section>
                    <section className="bg-white p-8 rounded-[3rem] shadow-sm border border-slate-100 text-center">
                        <div className="grid grid-cols-3 gap-3 mb-8">
                            {uploads.map((img, i) => <div key={i} className="relative aspect-square"><img src={img} className="w-full h-full object-cover rounded-2xl" /><button onClick={() => setUploads(u => u.filter((_, idx) => idx !== i))} className="absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full shadow-lg"><Icon name="x" size={10}/></button></div>)}
                            <label className="aspect-square bg-slate-50 border-2 border-dashed border-slate-200 rounded-2xl flex flex-col items-center justify-center cursor-pointer active:scale-95 transition-all"><Icon name="plus" size={18} className="text-slate-300"/><input type="file" multiple className="hidden" onChange={(e) => handleFile(e, 'act')} /></label>
                        </div>
                        <button onClick={runAI} disabled={loading || uploads.length === 0} className={`w-full py-5 rounded-[2rem] font-black text-lg shadow-xl flex items-center justify-center gap-2 ${loading || uploads.length === 0 ? 'bg-slate-100 text-slate-300' : 'bg-orange-600 text-white active:scale-95'}`}>{loading ? <Icon name="loader-2" className="animate-spin" /> : <><Icon name="send" size={18}/> å•Ÿå‹• AI åˆ¤å®š</>}</button>
                    </section>
                    {result && <div className={`p-8 rounded-[3rem] border-4 ${result.status === 'PASS' ? 'bg-emerald-50 border-emerald-100' : 'bg-red-50 border-red-100'} text-center animate-bounce duration-500`}><h4 className="text-2xl font-black mb-2">{result.status === 'PASS' ? 'åˆæ ¼' : 'éœ€æ”¹å–„'}</h4><p className="text-sm font-bold text-slate-600">{result.summary}</p></div>}
                </div>
            );

            return (
                <div className="p-4 space-y-4 page-enter">
                    <div className="flex justify-between items-center mb-6"><button onClick={onBack} className="p-3 bg-white rounded-2xl shadow-sm border border-slate-100"><Icon name="arrow-left" size={20}/></button><h2 className="text-xl font-black text-slate-800">å–„å¾Œå·¡è¦–ç³»çµ±</h2>{isManager && <button onClick={() => setIsSettings(true)} className="p-3 bg-white rounded-2xl shadow-sm border border-slate-100 text-slate-400"><Icon name="settings" size={20}/></button>}</div>
                    <div className="bg-gradient-to-r from-orange-500 to-orange-400 p-6 rounded-[2.5rem] text-white shadow-lg flex justify-between items-center mb-4"><div><p className="text-[10px] font-black uppercase opacity-70 mb-1">Progress</p><p className="text-2xl font-black">{completedZones.length} / {ZONES.length}</p></div><div className="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center border border-white/30 font-black tracking-tighter">{Math.round((completedZones.length/ZONES.length)*100)}%</div></div>
                    <div className="grid grid-cols-1 gap-2">
                        {ZONES.map(z => {
                            const done = completedZones.includes(z.id);
                            return <button key={z.id} onClick={() => setActiveZone(z)} className={`bg-white px-6 py-6 rounded-[2rem] shadow-sm flex justify-between items-center border ${done ? 'border-emerald-100 bg-emerald-50/20' : 'border-slate-100'}`}><div className="flex items-center gap-3"><div className={`p-2 rounded-xl ${done ? 'bg-emerald-100 text-emerald-600' : 'bg-slate-50 text-slate-300'}`}><Icon name={done ? 'check-circle' : 'camera'} size={18}/></div><span className={`font-black ${done ? 'text-emerald-700' : 'text-slate-600'}`}>{z.name}</span></div>{done ? <span className="text-[9px] font-black text-emerald-500">DONE</span> : <Icon name="chevron-right" size={18} className="text-slate-200" />}</button>
                        })}
                    </div>
                </div>
            );
        };

        const AdminPage = ({ onBack, onLogout, announcements, setAnnouncements, schedules, setSchedules, logs }) => {
            const [t, setT] = useState(''); const [c, setC] = useState('');
            const [month, setMonth] = useState(new Date().toISOString().slice(0, 7));
            const handleAnn = () => { if(t && c) { setAnnouncements([{ id: Date.now(), date: new Date().toISOString().slice(0,10), title: t, content: c, author: "ç®¡ç†å“¡" }, ...announcements]); setT(''); setC(''); } };
            const handleSch = (e) => { const files = Array.from(e.target.files); files.forEach(file => { const r = new FileReader(); r.onloadend = () => setSchedules(p => ({ ...p, [month]: [...(p[month] || []), r.result] })); r.readAsDataURL(file); }); };
            return (
                <div className="p-4 space-y-6 page-enter pb-20">
                    <div className="flex justify-between items-center"><BackButton onClick={onBack} title="å¾Œå°ç®¡ç†" /><button onClick={onLogout} className="bg-red-50 text-red-500 font-black text-[10px] px-4 py-2 rounded-full uppercase tracking-tighter">Logout</button></div>
                    <section className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                        <h3 className="font-black text-xs text-blue-500 uppercase tracking-widest mb-4 flex items-center gap-2"><Icon name="calendar" size={14}/> ç­è¡¨ç®¡ç† (æœˆä»½)</h3>
                        <div className="flex gap-2 mb-4"><input type="month" value={month} onChange={(e) => setMonth(e.target.value)} className="flex-1 bg-slate-50 p-3 rounded-xl font-bold outline-none text-sm border-0" /><label className="bg-blue-600 text-white px-4 py-3 rounded-xl text-[10px] font-black cursor-pointer uppercase active:scale-95 flex items-center gap-1">Upload<input type="file" multiple className="hidden" onChange={handleSch}/></label></div>
                        <div className="grid grid-cols-4 gap-2">{(schedules[month] || []).map((img, i) => <div key={i} className="relative aspect-square group"><img src={img} className="w-full h-full object-cover rounded-xl border shadow-sm" /><button onClick={() => setSchedules(p => ({...p, [month]: p[month].filter((_, idx) => idx !== i)}))} className="absolute -top-1 -right-1 bg-red-500 text-white p-1 rounded-full shadow-lg"><Icon name="trash-2" size={10}/></button></div>)}</div>
                    </section>
                    <section className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                        <h3 className="font-black text-xs text-orange-400 uppercase tracking-widest mb-4">ç³»çµ±æ—¥èªŒ</h3>
                        <div className="space-y-2">{logs.map((l, i) => <div key={i} className="text-[10px] bg-slate-50 p-2 rounded-lg text-slate-500 font-bold"><span className="text-orange-400 mr-2">[{l.time}]</span> {l.message}</div>)}</div>
                    </section>
                    <section className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                        <input placeholder="å…¬å‘Šæ¨™é¡Œ" value={t} onChange={e => setT(e.target.value)} className="w-full bg-slate-50 p-4 rounded-2xl mb-3 outline-none focus:ring-2 focus:ring-orange-500 font-bold text-sm" />
                        <textarea placeholder="å…¬å‘Šå…§å®¹" rows="3" value={c} onChange={e => setC(e.target.value)} className="w-full bg-slate-50 p-4 rounded-2xl mb-4 outline-none focus:ring-2 focus:ring-orange-500 text-sm" />
                        <button onClick={handleAnn} className="w-full bg-slate-900 text-white font-black py-4 rounded-2xl active:scale-95 transition-all">ç™¼å¸ƒ</button>
                    </section>
                    <div className="space-y-2">{announcements.map(a => <div key={a.id} className="bg-white p-4 rounded-2xl flex justify-between items-center border shadow-sm"><span className="font-bold text-xs text-slate-700 truncate mr-4">{a.title}</span><button onClick={() => setAnnouncements(announcements.filter(x => x.id !== a.id))} className="text-slate-200 hover:text-red-500 transition-colors"><Icon name="trash-2" size={16} /></button></div>)}</div>
                </div>
            );
        };

        // --- UI å·¥å…·çµ„ ---
        const BackButton = ({ onClick, title }) => (
            <div className="flex items-center gap-4 mb-8">
                <button onClick={onClick} className="p-3 bg-white rounded-2xl shadow-sm border border-slate-100 active:scale-90 transition-transform"><Icon name="arrow-left" size={20}/></button>
                <h2 className="text-2xl font-black text-slate-800 tracking-tighter">{title}</h2>
            </div>
        );
        const SectionItem = ({ title, icon, onClick }) => (
            <div onClick={onClick} className="bg-white p-6 rounded-[2rem] flex items-center justify-between shadow-sm border border-slate-100 active:bg-slate-50 cursor-pointer group">
                <div className="flex items-center gap-4 text-slate-400 group-active:text-orange-50"><Icon name={icon} size={18} /><span className="font-bold text-slate-700 text-sm">{title}</span></div>
                <Icon name="chevron-right" size={18} className="text-slate-200" />
            </div>
        );
        const AnnouncementDetailPage = ({ ann, onBack }) => (
            <div className="p-4 page-enter pb-10">
                <BackButton onClick={onBack} title="å…¬å‘Šè©³æƒ…" />
                <div className="bg-white rounded-[2.5rem] p-8 shadow-sm border border-slate-100 min-h-[40vh]">
                    <h1 className="text-2xl font-black text-slate-800 mb-2 leading-tight break-all">{ann?.title}</h1>
                    <p className="text-[10px] text-slate-400 font-bold mb-8 uppercase tracking-widest">{ann?.date} â€¢ By {ann?.author}</p>
                    <div className="text-sm text-slate-600 leading-relaxed break-all whitespace-pre-wrap font-medium">{ann?.content}</div>
                </div>
                <button onClick={onBack} className="w-full mt-6 py-4 bg-slate-900 text-white font-black rounded-2xl shadow-xl">è¿”å›é¦–é </button>
            </div>
        );
        const BenefitsPage = ({ onBack }) => <div className="p-4 space-y-4 page-enter"><BackButton onClick={onBack} title="è–ªè³‡ç¦åˆ©" /><div className="bg-gradient-to-br from-yellow-400 to-orange-500 p-8 rounded-[2.5rem] text-white shadow-lg mb-6"><p className="text-[10px] font-black uppercase opacity-80 leading-none mb-1">ä¼°è¨ˆè–ªè³‡åŠ çµ¦é ç®—</p><p className="text-3xl font-black">$ 32,800 +</p></div><SectionItem title="å„å€è€ƒæ ¸åŠ çµ¦æ¨™æº–" icon="coins" /><SectionItem title="å“¡å·¥ç›¸é—œç¦åˆ©" icon="heart" /></div>;

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
