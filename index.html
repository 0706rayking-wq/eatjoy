import React, { useState, useEffect } from 'react';
import { 
  Bell, 
  BookOpen, 
  ShieldCheck, 
  Briefcase, 
  Wallet, 
  Camera, 
  Menu as MenuIcon, 
  Calendar, 
  ChevronRight, 
  ArrowLeft,
  CheckCircle2,
  Clock,
  MapPin,
  Car
} from 'lucide-react';

const App = () => {
  const [currentPage, setCurrentPage] = useState('home');
  const [announcements, setAnnouncements] = useState([
    { id: 1, date: '2024-05-20', title: '夏季菜單調整通知', content: '從下週一起，熟食區將新增三道夏季涼拌菜，請各區人員留意出餐標準。', author: '主廚 阿明' },
    { id: 2, date: '2024-05-18', title: '設備維護公告', content: '週三凌晨將進行抽油煙機深度清潔，請晚班人員配合收場。', author: '店長 小華' }
  ]);

  // 各頁面渲染邏輯
  const renderContent = () => {
    switch (currentPage) {
      case 'home':
        return <HomePage onNavigate={setCurrentPage} announcements={announcements} />;
      case 'onboarding':
        return <OnboardingPage onBack={() => setCurrentPage('home')} />;
      case 'rules':
        return <RulesPage onBack={() => setCurrentPage('home')} />;
      case 'jobs':
        return <JobsPage onBack={() => setCurrentPage('home')} />;
      case 'benefits':
        return <BenefitsPage onBack={() => setCurrentPage('home')} />;
      case 'inspection':
        return <InspectionPage onBack={() => setCurrentPage('home')} />;
      case 'menu':
        return <MenuPage onBack={() => setCurrentPage('home')} />;
      case 'schedule':
        return <SchedulePage onBack={() => setCurrentPage('home')} />;
      default:
        return <HomePage onNavigate={setCurrentPage} announcements={announcements} />;
    }
  };

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-10">
      {/* 頂部狀態列 */}
      <div className="bg-orange-600 text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-md">
        <h1 className="font-bold text-xl tracking-tight" onClick={() => setCurrentPage('home')}>
          廚房管理系統 <span className="text-orange-200 text-xs font-normal ml-2">Kitchen OS v1.0</span>
        </h1>
        <div className="flex gap-3">
          <Bell size={20} />
          <MenuIcon size={20} />
        </div>
      </div>

      <main className="max-w-md mx-auto p-4">
        {renderContent()}
      </main>
    </div>
  );
};

// --- 子組件：首頁 ---
const HomePage = ({ onNavigate, announcements }) => (
  <div className="space-y-6 animate-in fade-in duration-500">
    {/* 營運調整公告 */}
    <section>
      <div className="flex items-center justify-between mb-3">
        <h2 className="text-lg font-bold flex items-center gap-2">
          <Bell className="text-orange-500" size={18} /> 營運調整公告
        </h2>
        <span className="text-xs text-slate-400">查看全部</span>
      </div>
      <div className="space-y-3">
        {announcements.map(ann => (
          <div key={ann.id} className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-orange-500">
            <div className="flex justify-between items-start mb-1">
              <h3 className="font-bold text-slate-800">{ann.title}</h3>
              <span className="text-[10px] text-slate-400 bg-slate-100 px-2 py-1 rounded-full">{ann.date}</span>
            </div>
            <p className="text-sm text-slate-600 line-clamp-2">{ann.content}</p>
            <p className="text-[10px] text-orange-600 mt-2 font-medium">發布者：{ann.author}</p>
          </div>
        ))}
      </div>
    </section>

    {/* 功能導覽格線 */}
    <section>
      <h2 className="text-lg font-bold mb-3">系統功能導覽</h2>
      <div className="grid grid-cols-2 gap-3">
        <NavCard icon={<BookOpen className="text-blue-500" />} title="入職相關" onClick={() => onNavigate('onboarding')} color="bg-blue-50" />
        <NavCard icon={<ShieldCheck className="text-green-500" />} title="員工守則" onClick={() => onNavigate('rules')} color="bg-green-50" />
        <NavCard icon={<Briefcase className="text-purple-500" />} title="工作簡介" onClick={() => onNavigate('jobs')} color="bg-purple-50" />
        <NavCard icon={<Wallet className="text-yellow-500" />} title="薪資福利" onClick={() => onNavigate('benefits')} color="bg-yellow-50" />
        <NavCard icon={<MenuIcon className="text-emerald-500" />} title="各季菜單" onClick={() => onNavigate('menu')} color="bg-emerald-50" />
        <NavCard icon={<Calendar className="text-indigo-500" />} title="每月班表" onClick={() => onNavigate('schedule')} color="bg-indigo-50" />
        <NavCard icon={<Camera className="text-red-500" />} title="善後巡視" onClick={() => onNavigate('inspection')} color="bg-red-50" span={true} />
      </div>
    </section>
  </div>
);

const NavCard = ({ icon, title, onClick, color, span = false }) => (
  <button 
    onClick={onClick}
    className={`${color} ${span ? 'col-span-2 py-6' : 'py-5'} flex flex-col items-center justify-center rounded-2xl shadow-sm border border-slate-100 active:scale-95 transition-transform`}
  >
    <div className="mb-2 scale-110">{icon}</div>
    <span className="font-bold text-slate-700">{title}</span>
  </button>
);

// --- 子組件：入職相關 ---
const OnboardingPage = ({ onBack }) => (
  <div className="space-y-4 animate-in slide-in-from-right duration-300">
    <BackButton onClick={onBack} title="入職相關資料" />
    <div className="space-y-3">
      <SectionItem icon={<BookOpen size={18}/>} title="員工入職準備清單" />
      <SectionItem icon={<Car size={18}/>} title="員工停車位資訊" />
      <SectionItem icon={<MapPin size={18}/>} title="上班打卡動線指引" />
    </div>
  </div>
);

// --- 子組件：善後巡視系統 (核心功能) ---
const InspectionPage = ({ onBack }) => {
  const stations = ["飲調區", "輕食區", "海鮮區", "蔬菜區", "切肉區", "冷盤區", "熟食區", "湯品區"];
  const [selectedStation, setSelectedStation] = useState(null);

  return (
    <div className="space-y-4 animate-in slide-in-from-right duration-300">
      <BackButton onClick={onBack} title="善後巡視系統 (AI)" />
      
      {!selectedStation ? (
        <div className="grid grid-cols-1 gap-3">
          <div className="bg-blue-50 p-4 rounded-xl text-sm text-blue-700 mb-2">
            請選擇您今日負責的崗位進行善後拍照：
          </div>
          {stations.map(s => (
            <button key={s} onClick={() => setSelectedStation(s)} className="bg-white p-4 rounded-xl flex justify-between items-center shadow-sm border border-slate-100">
              <span className="font-bold">{s}</span>
              <ChevronRight size={18} className="text-slate-400" />
            </button>
          ))}
        </div>
      ) : (
        <div className="space-y-6">
          <div className="flex items-center gap-2 text-slate-500" onClick={() => setSelectedStation(null)}>
            <ArrowLeft size={16} /> 返回區域選擇
          </div>
          <h3 className="text-xl font-bold text-center bg-slate-100 py-2 rounded-lg">{selectedStation} 善後檢查</h3>
          
          <div className="grid grid-cols-1 gap-4">
            <div className="space-y-2">
              <p className="text-sm font-medium text-slate-500">1. 標準模範照片 (參照組)</p>
              <div className="aspect-video bg-slate-200 rounded-xl flex items-center justify-center border-2 border-dashed border-slate-300">
                <span className="text-slate-400 text-sm">此處將顯示標準照片</span>
              </div>
            </div>
            
            <div className="space-y-2">
              <p className="text-sm font-medium text-slate-500">2. 您上傳的照片</p>
              <div className="aspect-video bg-white rounded-xl flex flex-col items-center justify-center border-2 border-orange-200 shadow-inner">
                <Camera size={40} className="text-orange-300 mb-2" />
                <span className="text-orange-500 font-bold">點擊啟動相機</span>
              </div>
            </div>

            <button className="w-full bg-orange-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-orange-200 mt-4">
              提交 AI 判定
            </button>
          </div>
        </div>
      )}
    </div>
  );
};

// --- 通用組件 ---
const BackButton = ({ onClick, title }) => (
  <div className="flex items-center gap-3 mb-6">
    <button onClick={onClick} className="p-2 bg-white rounded-full shadow-sm"><ArrowLeft size={20}/></button>
    <h2 className="text-xl font-bold">{title}</h2>
  </div>
);

const SectionItem = ({ icon, title }) => (
  <div className="bg-white p-4 rounded-xl flex items-center justify-between shadow-sm border border-slate-100 active:bg-slate-50">
    <div className="flex items-center gap-3">
      <div className="text-slate-400">{icon}</div>
      <span className="font-medium">{title}</span>
    </div>
    <ChevronRight size={18} className="text-slate-300" />
  </div>
);

// 其他預留頁面 (規則、工作、福利、菜單、班表)
const RulesPage = ({ onBack }) => (
  <div className="space-y-4 animate-in slide-in-from-right duration-300">
    <BackButton onClick={onBack} title="員工守則" />
    <div className="space-y-3">
      <SectionItem icon={<ShieldCheck size={18}/>} title="食品衛生安全規範" />
      <SectionItem icon={<ShieldCheck size={18}/>} title="職場職業安全守則" />
      <SectionItem icon={<ShieldCheck size={18}/>} title="廚房標準工作守則" />
    </div>
  </div>
);

const JobsPage = ({ onBack }) => (
  <div className="space-y-4 animate-in slide-in-from-right duration-300">
    <BackButton onClick={onBack} title="各區工作簡介" />
    <div className="grid grid-cols-1 gap-3">
      {["飲調/輕食區", "海鮮/冷盤區", "蔬菜/切肉區", "熟食/湯品區"].map(j => (
        <SectionItem key={j} title={j} />
      ))}
    </div>
  </div>
);

const BenefitsPage = ({ onBack }) => (
  <div className="space-y-4 animate-in slide-in-from-right duration-300">
    <BackButton onClick={onBack} title="薪資福利" />
    <div className="space-y-4">
      <div className="bg-gradient-to-br from-yellow-400 to-orange-500 p-6 rounded-3xl text-white shadow-lg">
        <p className="text-sm opacity-90">目前職等薪資</p>
        <p className="text-3xl font-black mt-1">$ --,---</p>
        <div className="mt-4 flex gap-2">
          <span className="bg-white/20 px-3 py-1 rounded-full text-xs">資深廚助</span>
          <span className="bg-white/20 px-3 py-1 rounded-full text-xs">全勤獎金中</span>
        </div>
      </div>
      <SectionItem title="各區考核加給標準" />
      <SectionItem title="三節與員工福利" />
      <SectionItem title="生日禮金與員工聚餐" />
    </div>
  </div>
);

const MenuPage = ({ onBack }) => (
  <div className="space-y-4 animate-in slide-in-from-right duration-300">
    <BackButton onClick={onBack} title="各季菜單介紹" />
    <div className="grid grid-cols-2 gap-3">
      {["熟食區", "甜點區", "限時限量", "壽星招待"].map(m => (
        <div key={m} className="aspect-square bg-white rounded-2xl flex items-center justify-center border border-slate-100 shadow-sm font-bold text-slate-600">
          {m}
        </div>
      ))}
    </div>
  </div>
);

const SchedulePage = ({ onBack }) => (
  <div className="space-y-4 animate-in slide-in-from-right duration-300">
    <BackButton onClick={onBack} title="每月班表查詢" />
    <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
      <div className="flex justify-between items-center mb-4">
        <span className="font-bold">2024 年 6 月</span>
        <button className="text-orange-600 text-sm font-bold">申請休假</button>
      </div>
      <div className="grid grid-cols-7 gap-1 text-center text-xs text-slate-400 mb-2">
        {['日','一','二','三','四','五','六'].map(d => <div key={d}>{d}</div>)}
      </div>
      <div className="grid grid-cols-7 gap-1">
        {Array.from({length: 30}).map((_, i) => (
          <div key={i} className={`aspect-square flex items-center justify-center rounded-lg text-sm ${[5, 12, 19, 26].includes(i+1) ? 'bg-orange-100 text-orange-600 font-bold' : 'bg-slate-50'}`}>
            {i+1}
          </div>
        ))}
      </div>
    </div>
    <div className="mt-4 p-4 bg-orange-50 border border-orange-100 rounded-xl">
      <h4 className="text-orange-700 font-bold text-sm mb-2">我的班表摘要</h4>
      <div className="flex justify-between text-sm text-orange-800">
        <span>本月休假已用：</span>
        <span className="font-bold">4 / 8 天</span>
      </div>
    </div>
  </div>
);

export default App;
